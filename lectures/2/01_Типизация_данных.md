# Типизация входных и выходных данных в FastAPI

## Введение

В Python есть аннотации типов (type hints).
Обычно они нужны для читаемости и IDE, но в FastAPI они становятся рабочим инструментом:
- проверяют входные данные,
- приводят к нужному типу,
- формируют документацию.

### Пример:
```
def add(a: int, b: int) -> int:
    return a + b
```

## Входные данные

### Path-параметры:  

```
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/{user_id}")
def read_user(user_id: int):
    return {"user_id": user_id}
```

Если указать user_id=5, всё ок.  
Если передать строку, FastAPI вернёт ошибку 422 — данные не соответствуют типу.  

### Query-параметры:  

```
@app.get("/items/")
def read_items(skip: int = 0, limit: int = 10):
    return {"skip": skip, "limit": limit}
```

skip и limit автоматически приводятся к int.
Если передать skip=abc, снова будет 422.

### Тело запроса (Body)

Для простых случаев можно аннотировать параметры напрямую:

```
from fastapi import Body

@app.post("/echo/")
def echo_message(message: str = Body(...)):
    return {"message": message}
```

Если отправить JSON {"message": "Привет"} → получим обратно.  
FastAPI проверяет, что поле действительно строка.  

## Выходные данные

### Тип возврата функции

```
@app.get("/sum")
def get_sum(a: int, b: int) -> int:
    return a + b
```

В аннотации стоит -> int.  
FastAPI использует это в документации (Swagger показывает, что возвращается число).  
Сам Python здесь не будет жёстко проверять тип, но аннотация помогает IDE и документации.

### Параметр response_model

Для простых случаев можно указать response_model:

```
@app.get("/numbers", response_model=list[int])
def get_numbers():
    return [1, 2, 3]
```

FastAPI понимает, что возвращается список чисел.  
Если случайно вернуть строку, будет ошибка сериализации.  

## Дополнительные возможности

Можно использовать Optional и Union из модуля typing:

```
from typing import Optional, Union

@app.get("/optional")
def get_optional(value: Optional[int] = None):
    return {"value": value}

@app.get("/union")
def get_union(x: Union[int, str]):
    return {"x": x}
```

Swagger автоматически покажет, что параметр может быть int или str.

## Заключение

Аннотации типов — это сердце FastAPI:

- делают API самодокументируемым,
- обеспечивают автоматическую валидацию,
- экономят время на проверках.

Для простых типов (int, str, bool, list) этого достаточно.  
Для сложных структур используется Pydantic — но это отдельная тема.